$((function(){RightMenu.init(),volantis.pjax.send((()=>{RightMenu.hideMenu()}))}));const RightMenu=(()=>{const e={},t=$("#printHtml"),n=$("#menuMusic"),o=$("#menuDarkBtn"),i=$("#readingModel"),r=$(".menuLoad-Content"),a=$("#rightmenu-wrapper")[0],c=$("#rightmenu-content")[0],l=$('.menu-Option[data-fn-type="copyText"]'),s=$('.menu-Option[data-fn-type="copyPaste"]'),d=$('.menu-Option[data-fn-type="copySelect"]'),h=$('.menu-Option[data-fn-type="copyCut"]'),g=$('.menu-Option[data-fn-type="copyHref"]'),u=$('.menu-Option[data-fn-type="copySrc"]'),m=$('.menu-Option[data-fn-type="copyImg"]'),p=$('.menu-Option[data-fn-type="openTab"]'),f=/^((https|http)?:\/\/)+[A-Za-z0-9]+\.[A-Za-z0-9]+[\/=\?%\-&_~`@[\]\':+!]*([^<>\"\"])*$/;return e.init=()=>{n.hide(),$(".menu-Option").hide(),$("#read_bkg").remove();const e=document.createElement("div");e.className="common_read_bkg common_read_hide",e.id="read_bkg",window.document.body.appendChild(e)},e.initEvent=()=>{window.document.oncontextmenu=t=>t.ctrlKey||$(window).width()<=500?(e.hideMenu(),!0):e.popMenu(t),a.oncontextmenu=e=>(e.stopPropagation(),e.preventDefault(),!1),$(window).off("click.rightMenu").on("click.rightMenu",(()=>{e.hideMenu()})),$(window).off("blur.rightMenu").on("blur.rightMenu",(()=>{e.hideMenu()})),$(a).off("blur.rightMenu").on("blur.rightMenu",(()=>{e.hideMenu()}))},e.popMenu=t=>{let n=t.clientX,o=t.clientY,i=document.documentElement.clientWidth||document.body.clientWidth,r=document.documentElement.clientHeight||document.body.clientHeight;try{e.setMenuItem(t),$(a).focus(),a.style.display="block",a.style.zIndex="-2147483648";let l=c.offsetWidth,s=c.offsetHeight,d=n+l>i?n-l+10:n,h=o+s>r?o-s+10:o;h=o+s>r&&h<s&&o<s?h+(r-s-h-10):h,a.style.left=d+"px",a.style.top=h+"px",a.style.zIndex="2147483648"}catch(e){return $(a).blur(),console.error(e),!0}return!1},e.setMenuItem=a=>{let c=!1;const w=a.target,M=window.getSelection().toString();if(p.hide(),o&&o.off("click.rightMenu").one("click.rightMenu",(e=>{o.children().toggleClass("<%= theme.rightmenu.darkmode.dark %>"),o.children().toggleClass("<%= theme.rightmenu.darkmode.white %>")})),$(w).is("input")||$(w).is("textarea")){const t=$(w).val();t.length>0?(d.show(),d.off("click.rightMenu").one("click.rightMenu",(()=>{$(w).select()}))):d.hide(),M?(h.show(),h.off("click.rightMenu").one("click.rightMenu",(()=>{const n=w.selectionStart,o=w.selectionEnd;e.copyString(M),$(w).val(t.substring(0,n)+t.substring(o,t.length)),w.selectionStart=n,w.selectionEnd=n,$(w).focus()}))):h.hide(),e.readClipboard().then((t=>{t?(s.show(),s.off("click.rightMenu").one("click.rightMenu",(()=>{e.insertAtCaret($(w),t)}))):s.hide()})).catch((e=>{console.error(e),s.hide()}))}else d.hide(),s.hide(),h.hide();const y=w.href;y&&f.test(y)?(c=!0,g.show(),p.show(),g.off("click.rightMenu").one("click.rightMenu",(()=>{e.copyString(y)})),p.off("click.rightMenu").one("click.rightMenu",(()=>{window.open(y)}))):g.hide();const b=w.currentSrc;b&&f.test(b)?(c=!0,u.show(),p.show(),u.off("click.rightMenu").one("click.rightMenu",(()=>{e.copyString(b)})),p.off("click.rightMenu").one("click.rightMenu",(()=>{window.open(b)}))):u.hide(),b&&f.test(b)&&b.trimEnd().endsWith(".png")?(c=!0,m.show(),m.off("click.rightMenu").one("click.rightMenu",(()=>{e.writeClipImg(a,(()=>{volantis.message("操作提示","复制成功！","success")}),(e=>{volantis.message("操作提示","复制失败："+e,"error")}))}))):m.hide(),M?(c=!0,l.show(),l.off("click.rightMenu").one("click.rightMenu",(()=>{e.copyString(M)}))):l.hide();const v=$("#post.article").html()||null,k=window.location.pathname;v?(t.show(),i.show(),t.off("click.rightMenu").one("click.rightMenu",(t=>{window.location.pathname===k?e.printHtml():e.hideMenu()})),i.off("click.readingModel").one("click.readingModel",(t=>{window.location.pathname,e.readingModel()}))):(t.hide(),i.hide()),"play"===volantis.APlayerController.status?(c=!0,n.show()):n.hide(),c?r.hide():r.show(),1==volantis.rightMenu.music&&volantis.APlayerController.APlayerLoaded&&MainAPlayer.checkAPlayer()},e.hideMenu=()=>{a.style.display="none"},e.copyString=t=>{e.writeClipText(t).then((()=>{volantis.message("操作提示",t.length>120?t.substring(0,120)+"...":t,"info")})).catch((e=>{volantis.message("操作提示",e,"error")}))},e.writeClipText=e=>{try{return navigator.clipboard.writeText(e).then((()=>Promise.resolve())).catch((e=>Promise.reject(e)))}catch(t){const n=document.createElement("input");n.setAttribute("readonly","readonly"),document.body.appendChild(n),n.setAttribute("value",e),n.select();try{let e=document.execCommand("copy");return document.body.removeChild(n),e&&"unsuccessful"!==e?Promise.resolve():Promise.reject("复制文本失败!")}catch(e){return document.body.removeChild(n),Promise.reject("当前浏览器不支持复制功能，请检查更新或更换其他浏览器操作!")}}},e.writeClipImg=async function(e,t,n){const o=e.target.currentSrc.replace("https://static.inkss.cn/img/article/","https://cdn.jsdelivr.net/gh/inkss/common@master/hexo/img/article/"),i=e.target.parentElement;try{const e=await fetch(o),i=await e.blob();await navigator.clipboard.write([new ClipboardItem({[i.type]:i})]).then((()=>{t()}),(e=>{console.error("图片复制失败：",e),n(e)}))}catch(e){const o=document;try{if(o.body.createTextRange){const e=document.body.createTextRange();e.moveToElementText(i),e.select()}else if(window.getSelection){const e=window.getSelection(),t=document.createRange();t.selectNodeContents(i),e.removeAllRanges(),e.addRange(t)}document.execCommand("copy"),window.getSelection().removeAllRanges(),t()}catch(e){console.error(e),n("不支持复制当前图片！")}}},e.readClipboard=async()=>{const e=await navigator.permissions.query({name:"clipboard-read"});return"granted"===e.state||"prompt"===e.state?navigator.clipboard.readText().then((e=>e)).catch((e=>Promise.reject(e))):Promise.reject(e)},e.insertAtCaret=(e,t)=>{const n=e[0],o=n.selectionStart,i=n.selectionEnd;if(document.selection)e.focus(),document.selection.createRange().text=t,e.focus();else if(o||"0"==o){var r=n.scrollTop;n.value=n.value.substring(0,o)+t+n.value.substring(i,n.value.length),e.focus(),n.selectionStart=o+t.length,n.selectionEnd=o+t.length,n.scrollTop=r}else e.value+=t,e.focus()},e.printHtml=()=>{volantis.isReadModel&&e.readingModel(),!0===volantis.rightMenu.defaultStyles&&($("body").css({backgroundColor:"unset"}),$("#l_header").hide(),$("#l_cover").hide(),$("#l_side").hide(),$("#l_main").css({width:"100%"}),$("#post").css({"box-shadow":"none",background:"none",padding:"0"}),$("h1").css({"text-align":"center","font-weight":"600","font-size":"2rem","margin-bottom":"20px"}),$(".prev-next").hide(),$("#bottom").children().append('<div class="new-meta-item"><a class="tag" href="'+window.location.href+'" rel="nofollow" data-pjax-state=""><i class="fad fa-external-link fa-fw" aria-hidden="true"></i><p>本文地址：'+window.location.href+"</p></a></div>"),$("#comments").hide(),$("#s-top").hide(),$("footer").hide(),$("#rightmenu-wrapper").hide(),$("details").attr("open","true"),$(".tab-pane").css({display:"block"}),$(".tab-content").css({"border-top":"none"}),$(".highlight>table pre").css({"white-space":"pre-wrap","word-break":"break-all"}),$(".nav-tabs").hide(),$(".backstretch").hide(),$(".fancybox img").css({height:"auto",weight:"auto"}),$("#BKG").hide(),$("img").removeAttr("srcset data-srcset").removeClass("img lazyload loaded")),!0===volantis.rightMenu.printJs&&volantis.rightMenu.printJsFun(),$(document).click(),setTimeout((()=>{window.print(),document.body.innerHTML="",window.location.reload()}),50)},e.readingModel=()=>{$(".cus-article-bkg").fadeToggle(),$("#BKG").fadeToggle(),$("#l_header").fadeToggle(),$("footer").fadeToggle(),$("#s-top").fadeToggle(),$(".article-meta#bottom").fadeToggle(),$(".prev-next").fadeToggle(),$(".widget").fadeToggle(),$("#comments").fadeToggle(),$("#l_main").toggleClass("common_read common_read_main"),$("#l_body").toggleClass("common_read"),$("#safearea").toggleClass("common_read"),$("#pjax-container").toggleClass("common_read"),$("#read_bkg").toggleClass("common_read_hide"),$("h1").toggleClass("common_read_h1"),$("#post").toggleClass("post_read"),$("#l_cover").toggleClass("read_cover"),$(".widget.toc-wrapper").toggleClass("post_read"),volantis.isReadModel=void 0===volantis.isReadModel||!volantis.isReadModel,volantis.isReadModel?$("#l_body").off("click.rightMenu").on("click.rightMenu",(t=>{$(t.target).hasClass("common_read")&&e.readingModel()})):($("#l_body").off("click.rightMenu"),$("#post").off("click.rightMenu"))},{init:(t=!1)=>{e.init(),e.initEvent(),t&&volantis.message("操作提示","自定义右键注册成功。","success")},destroy:(t=!1)=>{e.hideMenu(),$(window).off("click.rightMenu"),$(window).off("blur.rightMenu"),$(a).off("blur.rightMenu"),window.document.oncontextmenu=()=>!0,t&&volantis.message("操作提示","自定义右键注销成功。","success")},hideMenu:()=>{e.hideMenu()}}})();Object.freeze(RightMenu);